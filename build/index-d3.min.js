var chatbot=function(e){function t(e){return function(){var t=d3.interpolateNumber(n.scroll.property("scrollTop"),e);return function(e){n.scroll.property("scrollTop",t(e))}}}var n={};return n.container=e,n.config=null,n.bubbles=[],n.ID=0,n.keys={},n.types={},n.scroll=e.append("div").attr("id","cb-flow"),n.flow=n.scroll.append("div").attr("class","cb-inner"),n.input=e.append("div").attr("id","cb-input").style("display","none"),n.input.append("input").attr("type","text"),n.input.append("button").text("+"),n.addBubble=function(e,t){if(t=t||function(){},e.type in n.types){n.ID++;var l=n.ID;n.bubbles.push({id:l,type:e.type}),n.keys[l]=n.bubbles.length-1;var c=n.flow.append("div").attr("class","cb-segment cb-"+e.class).attr("id","cb-segment-"+l);c.append("div").attr("class","cb-icon");var i=c.append("div").attr("class","cb-bubble "+e.class).append("div").attr("class","cb-inner");return c.append("hr"),n.types[e.type](i,e,t),n.scrollTo("end"),n.ID}throw"Unknown bubble type"},n.types.select=function(e,t,n){e.select(".cb-choice").data(t.value).enter().append("div").attr("class","cb-choice").text(function(e){return e.label}).on("click",function(e){d3.select("this").classed("cb-active",!0),n(e)})},n.types.text=function(e,t,n){function l(e,t,n){e.attr("class","bubble-ctn-"+t.class).append("p").style("width","50px").html(t.value).transition().duration(200).style("width","auto").style("opacity",1),n()}if("delay"in t&&t.delay){var c='<div class="circle"></div><div class="circle"></div><div class="circle"></div>';e.append("div").attr("class","cb-waiting").html(c),setTimeout(function(){e.select(".cb-waiting").remove(),l(e,t,n)},isNaN(t.delay)?1e3:t.delay)}else l(e,t,n)},n.showInput=function(e,t){t?n.input.select("input").on("change",function(){t(d3.select(this).node().value)}):n.input.select("input").on("change",function(){}),n.input.select("button").on("click",function(){e(n.input.select("input").node().value)}),n.input.style("display","block"),n.flow.classed("cb-w-input",!0),n.input.select("input").node().blur(),n.scrollTo("end")},n.hideInput=function(){n.input.style("display","none"),n.flow.classed("cb-w-input",!1),n.scrollTo("end")},n.removeBubble=function(e){n.flow.select("#cb-segment-"+e).remove(),n.bubbles.splice(n.keys[e],1),delete n.keys[e]},n.removeBubbles=function(e){for(var t=n.bubbles.length-1;t>=n.keys[e];t--)n.removeBubble(n.bubbles[t].id)},n.getBubble=function(e){return{el:n.flow.select("#cb-segment-"+e),obj:n.bubbles[n.keys[e]]}},n.scrollTo=function(e){var l=0;"end"==e&&(l=n.scroll.property("scrollHeight")-window.innerHeight),d3.select("#cb-flow").transition().duration(300).tween("scroll",t(l))},n};